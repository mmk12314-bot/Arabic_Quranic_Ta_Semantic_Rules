# ملف: src/ai_integration_demo.py

# نقوم باستيراد دالة التصحيح التي قمت بإنشائها
from ta_corrector import apply_semantic_ta_correction

# -----------------------------------------------------------------------------
# 1. محاكاة عمل نموذج الذكاء الاصطناعي (LLM)
# -----------------------------------------------------------------------------

def mock_ai_generation(prompt):
    """
    تحاكي هذه الدالة توليد النص من نموذج AI، وتقدم أمثلة تحتوي على أخطاء محتملة.
    """
    print(f"\n[الخطوة 1: توليد النص بواسطة نموذج AI استجابةً لـ: '{prompt}']")
    
    # نموذج AI يولد نصاً قد يكون فيه خطأ
    if "العدل" in prompt:
        # خطأ: الإضافة إلى المعرف بـ "الـ"
        return "لقد جاء الإسلام ليؤكد على رَحْمَةُ الله بين عباده وعلى نِعْمَةُ العيش"
    elif "نوح" in prompt:
        # خطأ: الإضافة إلى اسم علم
        return "زوجته هي إِمْرَأَةُ نوحٍ"
    elif "نعمتك" in prompt:
        # خطأ: الإضافة إلى ضمير
        return "اذكروا نِعْمَةُكُمْ عليهم"
    else:
        # نص صحيح لا يتطلب تصحيحاً (الكلمة نكرة)
        return "كانت في حياته نِعْمَةٌ عظيمة"

# -----------------------------------------------------------------------------
# 2. طبقة التصحيح (Post-Processing)
# -----------------------------------------------------------------------------

def final_text_processor(prompt_text):
    """
    تطبق طبقة التصحيح الدلالي على مخرج نموذج الذكاء الاصطناعي.
    """
    # 1. توليد النص الأولي من النموذج (المرحلة الأولى)
    raw_ai_output = mock_ai_generation(prompt_text)
    
    print(f"   الناتج الأولي (المشكوك فيه): {raw_ai_output}")
    
    # 2. تمرير الناتج الأولي إلى دالتك للتصحيح (المرحلة الثانية: دمج الكود الخاص بك)
    final_corrected_output = apply_semantic_ta_correction(raw_ai_output)
    
    print("\n[الخطوة 2: تطبيق طبقة التصحيح الدلالي]")
    print(f"   الناتج النهائي (المصحح): {final_corrected_output}")
    print("--------------------------------------------------")
    
    return final_corrected_output

# -----------------------------------------------------------------------------
# 3. سيناريوهات الاختبار (تم تحديث الأمثلة)
# -----------------------------------------------------------------------------

if __name__ == '__main__':
    
    # سيناريو 1: يتطلب تصحيحاً (الإضافة إلى معرف بـ "الـ")
    final_text_processor("ما هي أهمية العدل في الإسلام؟")
    
    # سيناريو 2: يتطلب تصحيحاً (الإضافة إلى اسم عَلَم: نوح) - اختبار الشرط الجديد (ب)
    final_text_processor("من هي إمرأة نوح؟")
    
    # سيناريو 3: يتطلب تصحيحاً (الإضافة إلى ضمير: نعمتكم) - اختبار الشرط الجديد (ج)
    final_text_processor("هل يجب أن نذكر نعمتك علينا؟")
    
    # سيناريو 4: لا يتطلب تصحيحاً (نص نكرة)
    final_text_processor("كيف كانت نعمة عظيمة؟")
