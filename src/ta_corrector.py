def apply_semantic_ta_correction(text_output):
    """
    تطبق القاعدة الدلالية للتاء المفتوحة/المربوطة على نص مُولّد.
    تعتمد على مؤشر الإضافة إلى اسم مُعَرَّف بأل (الـ).
    
    Parameters:
    - text_output (str): النص المراد فحصه وتصحيحه (عادة يكون ناتج نموذج AI).
    
    Returns:
    - str: النص المصحح وفقاً للقاعدة الدلالية للتاء.
    """
    
    # قائمة الكلمات المرشحة التي يحدث فيها التناوب (بالتاء المربوطة في غير الرسم القرآني)
    # هذه القائمة مأخوذة من البيانات الموثقة في المشروع:
    candidate_words = ["نعمة", "رحمة", "سنة", "شجرة", "لعنة", "امرأة", "فطرة", "جنة", "بقية", "ابنة", "معصية", "قرة", "كلمة", "غيابة", "سخط", "لات", "جمالت"]
    
    # تقسيم النص إلى كلمات
    words = text_output.split()
    
    for i in range(len(words)):
        current_word = words[i]
        
        # 1. التحقق مما إذا كانت الكلمة الحالية مرشحة (بالتاء المربوطة)
        # نقوم بتجريد الكلمة من التنوين أو الحركات القصيرة للمطابقة الأساسية
        # ونضيف التاء المربوطة للتأكد من أن الكلمة بالأساس مرشحة.
        # (هذه طريقة مبسطة للمطابقة وتعتبر مناسبة لنموذج أولي)
        word_base = current_word.strip('ًٌٍَة') + 'ة'
        
        if word_base in candidate_words and 'ة' in current_word:
            
            # 2. التحقق من وجود كلمة تالية (المضاف إليه)
            if i + 1 < len(words):
                next_word = words[i + 1]
                
                # 3. التحقق من التعيين: هل الكلمة التالية تبدأ بـ "الـ" التعريف؟
                # هذا هو المحفز الدلالي القوي الذي يوجب التاء المفتوحة.
                if next_word.startswith("ال"): 
                    
                    # 4. تطبيق التصحيح: استبدال التاء المربوطة بالتاء المفتوحة
                    # نقوم بالاستبدال مرة واحدة فقط (1) لضمان عدم التأثير على كلمات أخرى.
                    corrected_word = current_word.replace('ة', 'ت', 1)
                    words[i] = corrected_word
                    
    # إعادة تجميع الكلمات إلى نص واحد
    return " ".join(words)


# -----------------------------------------------------------------------------
# قسم الاختبار (يمكن تشغيله لفحص عمل الدالة)
if __name__ == '__main__':
    
    print("--- اختبار نموذج تصحيح القاعدة الدلالية للتاء ---")
    
    # مثال 1: حالة يجب تصحيحها (نعمة مُضافة إلى معرفة)
    text1 = "يجب أن نشكر نِعْمَةُ الخالق"
    corrected1 = apply_semantic_ta_correction(text1)
    print(f"\nالنص الأصلي 1: {text1}")
    print(f"النص المصحح 1: {corrected1}  (تم تغيير 'نِعْمَةُ' إلى 'نِعْمَتُ')")
    
    # مثال 2: حالة لا يجب تصحيحها (الكلمة نكرة أو مُضافة إلى نكرة)
    text2 = "قرأت عن شَجَرَةٍ جميلة"
    corrected2 = apply_semantic_ta_correction(text2)
    print(f"\nالنص الأصلي 2: {text2}")
    print(f"النص المصحح 2: {corrected2}  (لم يتم التصحيح)")
    
    # مثال 3: حالة يجب تصحيحها أخرى
    text3 = "إن رَحْمَةُ الله واسعة"
    corrected3 = apply_semantic_ta_correction(text3)
    print(f"\nالنص الأصلي 3: {text3}")
    print(f"النص المصحح 3: {corrected3} (تم تغيير 'رَحْمَةُ' إلى 'رَحْمَتُ')")
